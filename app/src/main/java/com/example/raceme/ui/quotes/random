if (stats.cumulativeSteps >= 1_000 && "first_1k" !in earned) {
    toAward += BadgeAward(BadgeCatalog.FIRST_1K)
}

if (stats.currentStreakDays >= 7 && "streak_7" !in earned) {
    toAward += BadgeAward(BadgeCatalog.STREAK_7)
}
if (stats.currentStreakDays >= 30 && "streak_30" !in earned) {
    toAward += BadgeAward(BadgeCatalog.STREAK_30)
}

if (stats.firstStepsAt != null &&
stats.firstStepsAt.isBefore(LocalTime.of(9, 0)) &&
"early_riser" !in earned
) {
    toAward += BadgeAward(BadgeCatalog.EARLY_RISER)
}

val dow = stats.timestamp.dayOfWeek
val isWeekend = (dow == DayOfWeek.SATURDAY || dow == DayOfWeek.SUNDAY)
if (isWeekend && stats.stepsToday >= 8_000 && "weekend_warrior" !in earned) {
    toAward += BadgeAward(BadgeCatalog.WEEKEND_WARRIOR)
}








if (stats.hasDisplayName && stats.hasBio && stats.hasPhoto && "profile_complete" !in earned) {
    toAward += BadgeAward(BadgeCatalog.PROFILE_COMPLETE)
}

// Persist any newly earned
if (toAward.isNotEmpty()) {
    val updated = earned + toAward.map { it.badge.id }
    BadgeStore.saveEarnedIds(context, stats.userId, updated)
}

return toAward
}